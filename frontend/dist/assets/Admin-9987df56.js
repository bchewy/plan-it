import{M as I,a as w}from"./MapItem-bd834173.js";import{A as x,F as N,B as P}from"./Badges-8adfbbcb.js";import{N as T}from"./Navbar-faf4802b.js";import{_ as A,u as V,e as f,s as k,r as M,o as r,c,b as D,a as e,q as _,x as u,F as p,f as v,y,i as E,t as m,p as C,h as O}from"./index-0fdca0a9.js";import{a as g}from"./axios-21b846bc.js";import{l as U}from"./index-f203fe86.js";/* empty css              */const L={async created(){await this.fetchData()},data(){const{user:t,isAuthenticated:s}=V(),d=f(0),o=f(0),l=f(0);return{users:[],userExp:d,expToNextLevel:o,userLvl:l,user:t,badges:[],isAuthenticated:s,updatedUser:{email:"",level:0,exp:0},newBadge:{name:"",description:"",milestone:"",image:null},selectedBadges:k({}),searchUser:"",searchBadge:""}},computed:{filteredUsers(){return this.users.filter(t=>t.handle.includes(this.searchUser))},filteredBadges(){return this.badges.filter(t=>t.name.includes(this.searchBadge))}},components:{Navbar:T,MapItem:I,AddFriend:x,FriendRequest:N,Badges:P},methods:{hasBadge(t,s){return t&&t.badges&&t.badges.includes(s)},toggleBadge(t,s){if(this.hasBadge(t,s)){const d=t.badges.indexOf(s);d>-1&&t.badges.splice(d,1)}else t.badges.push(s)},handleBadgeChange(t,s){this.hasBadge(t,s)?this.unassignBadges(t.email,s):this.assignBadges(t.email,[s])},async assignBadges(t,s){const d=`${{}.VITE_API_ENDPOINT}/users/${t}/badges`,o={"x-api-key":`${{}.VITE_API_KEY}`};try{await g.put(d,{badges:s},{headers:o}),console.log("Badges assigned successfully"),this.fetchUsers()}catch(l){console.error("Error assigning badges:",l)}},async unassignBadges(t,s){const d=`${{}.VITE_API_ENDPOINT}/users/${t}/badges/${s}`,o={"x-api-key":`${{}.VITE_API_KEY}`};try{await g.delete(d,{headers:o}),console.log("Badge unassigned successfully"),this.fetchUsers()}catch(l){console.error("Error unassigning badge:",l)}},handleFileUpload(t){this.newBadge.image=t.target.files[0]},openModal(t){this.updatedUser.email=t.email,this.updatedUser.level=t.level,this.updatedUser.exp=t.exp},async addBadge(){let t=document.getElementById("addBadgeModal"),s=new w(t);if(s.show(),!this.newBadge.name||!this.newBadge.description||!this.newBadge.image||!this.newBadge.milestone){U.error("Please fill in all fields.",{autoClose:5e3,position:U.POSITION.TOP_CENTER});return}console.log("Adding badge"),console.log(this.newBadge),console.log(this.newBadge.image);const d=new FormData;d.append("name",this.newBadge.name),d.append("description",this.newBadge.description),d.append("image",this.newBadge.image),d.append("milestone",this.newBadge.milestone);try{const o=await g.post(`${{}.VITE_API_ENDPOINT}/badges`,d,{headers:{"x-api-key":`${{}.VITE_API_KEY}`}});console.log(o.data.message),s.hide(),this.badges=[],this.fetchBadges()}catch(o){console.error(o)}},updateUser(){const t=`${{}.VITE_API_ENDPOINT}/users/${this.updatedUser.email}/replace/level`,s={"x-api-key":`${{}.VITE_API_KEY}`};g.post(t,{level:this.updatedUser.level},{headers:s}).then(d=>{console.log(d.data),this.fetchUsers()}).catch(d=>{console.error("Error updating level:",d)})},fetchData(){this.fetchUsers(),this.fetchBadges()},async fetchUsers(){const t=`${{}.VITE_API_ENDPOINT}/users`,s={"x-api-key":`${{}.VITE_API_KEY}`};try{const d=await g.get(t,{headers:s});this.users=d.data;for(let o of this.users){const l=`${{}.VITE_API_ENDPOINT}/users/${o.email}/badges`,n=await g.get(l,{headers:s});o.badges=n.data,this.selectedBadges[o.email]=o.badges.map(b=>b._id)}}catch(d){console.error("Error fetching data:",d)}},async fetchBadges(){const t=`${{}.VITE_API_ENDPOINT}/badges`,s={"x-api-key":`${{}.VITE_API_KEY}`};try{const d=await g.get(t,{headers:s});this.badges=d.data}catch(d){console.error("Error fetching badges:",d)}},async deleteBadge(t){const s=`${{}.VITE_API_ENDPOINT}/badges/${t}`,d={"x-api-key":`${{}.VITE_API_KEY}`};try{await g.delete(s,{headers:d}),console.log("Badge deleted"),this.badges=[],this.fetchBadges()}catch(o){console.error("Error deleting badge:",o)}}}},i=t=>(C("data-v-7b0f9968"),t=t(),O(),t),F={class:"container-fluid pt-3 bg-supergreen pb-3"},S={class:"row"},K={class:"col"},Y={class:"card mt-4 mb-4"},R=i(()=>e("div",{class:"card-header"},[e("h3",{class:"mb-0"},"User Management")],-1)),X={class:"container-fluid"},j={class:"row"},q={class:"col-12 mt-5"},H={class:"table-responsive"},z={class:"table"},G=i(()=>e("thead",null,[e("tr",null,[e("th",null,"Handle"),e("th",null,"Progress"),e("th",null,"Badges"),e("th",null,"Actions")])],-1)),J=["src"],Q=i(()=>e("br",null,null,-1)),W={key:0},Z={key:1},$=["value","checked","onChange"],ee={class:"text-muted"},se=["src"],te=["onClick"],ae={class:"row"},de={class:"col"},le={class:"card mt-4 mb-4"},oe={class:"card-header"},ne=i(()=>e("h3",{class:"mb-0"},"Badge Management",-1)),ie={class:"container-fluid"},re={class:"row"},ce={class:"col-12 mt-5"},he={class:"table table-striped"},ge=i(()=>e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"Badge"),e("th",{scope:"col"},"Description"),e("th",{scope:"col"},"Actions")])],-1)),_e={scope:"row"},ue=["src"],me=["onClick"],pe={class:"modal",id:"addUserModal",tabindex:"-1","aria-labelledby":"addUserModalLabel","aria-hidden":"true",ref:"addUserModal"},be={class:"modal-dialog"},fe={class:"modal-content"},ve=i(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"addUserModalLabel"},"Update User Level and EXP"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Be={class:"modal-body"},ye={class:"mb-3"},Ee=i(()=>e("label",{for:"user-level",class:"form-label"},"Level",-1)),Ue={class:"mb-3"},Ie=i(()=>e("label",{for:"user-exp",class:"form-label"},"EXP",-1)),we=i(()=>e("button",{type:"submit",class:"btn btn-success","data-bs-dismiss":"modal"},"Update",-1)),xe={class:"modal",id:"addBadgeModal",tabindex:"-1","aria-labelledby":"addBadgeModalLabel","aria-hidden":"true",ref:"addBadgeModal"},Ne={class:"modal-dialog"},Pe={class:"modal-content"},Te=i(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"addBadgeModalLabel"},"Add New Badge"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Ae={class:"modal-body"},Ve={class:"mb-3"},ke=i(()=>e("label",{for:"badge-name",class:"form-label"},"Name",-1)),Me={class:"mb-3"},De=i(()=>e("label",{for:"badge-description",class:"form-label"},"Description",-1)),Ce={class:"mb-3"},Oe=i(()=>e("label",{for:"badge-milestone",class:"form-label"},"Milestone",-1)),Le={class:"mb-3"},Fe=i(()=>e("label",{for:"badge-image",class:"form-label"},"Image",-1)),Se=i(()=>e("button",{type:"submit",class:"btn btn-success","data-bs-dismiss":"modal"},"Add",-1));function Ke(t,s,d,o,l,n){const b=M("Navbar");return r(),c(p,null,[D(b),e("div",F,[e("div",S,[e("div",K,[_(e("input",{class:"input-group-text",type:"text","onUpdate:modelValue":s[0]||(s[0]=a=>l.searchUser=a),placeholder:"Search users..."},null,512),[[u,l.searchUser]]),e("div",Y,[R,e("div",X,[e("div",j,[e("div",q,[e("div",H,[e("table",z,[G,e("tbody",null,[(r(!0),c(p,null,v(n.filteredUsers,(a,B)=>(r(),c("tr",{key:a},[e("td",null,[e("img",{class:"img-fluid w-25",src:a.pictureurl,alt:"User Image"},null,8,J),Q,E(" @"+m(a.handle),1)]),a.level?(r(),c("td",W,"Lvl "+m(a.level)+", EXP: "+m(a.exp)+"/100",1)):(r(),c("td",Z,"-")),e("td",null,[(r(!0),c(p,null,v(l.badges,h=>(r(),c("div",{key:h._id,class:"badge-select"},[e("input",{type:"checkbox",value:h._id,checked:n.hasBadge(a,h._id),onChange:Ye=>n.handleBadgeChange(a,h._id)},null,40,$),e("label",ee,m(h.name),1),e("img",{src:h.image,class:"badge-image",style:{width:"30px"}},null,8,se)]))),128))]),e("td",null,[e("button",{class:"btn btn-success",onClick:h=>n.openModal(a),"data-bs-toggle":"modal","data-bs-target":"#addUserModal"},"Edit",8,te)])]))),128))])])])])])])])])]),e("div",ae,[e("div",de,[_(e("input",{class:"input-group-text",type:"text","onUpdate:modelValue":s[1]||(s[1]=a=>l.searchBadge=a),placeholder:"Search Badges..."},null,512),[[u,l.searchBadge]]),e("div",le,[e("div",oe,[ne,e("button",{class:"btn btn-success mt-3 mb-2",onClick:s[2]||(s[2]=(...a)=>n.addBadge&&n.addBadge(...a))},"Add New Badge")]),e("div",ie,[e("div",re,[e("div",ce,[e("table",he,[ge,e("tbody",null,[(r(!0),c(p,null,v(n.filteredBadges,(a,B)=>(r(),c("tr",{key:a},[e("th",_e,m(B+1),1),e("td",null,m(a.name),1),e("td",null,[e("img",{src:a.image,class:"w-25 h-25"},null,8,ue),E(" "+m(a.description),1)]),e("td",null,[e("button",{class:"btn btn-danger",onClick:h=>n.deleteBadge(a._id)},"Delete",8,me)])]))),128))])])])])])])])]),e("div",pe,[e("div",be,[e("div",fe,[ve,e("div",Be,[e("form",{onSubmit:s[5]||(s[5]=y((...a)=>n.updateUser&&n.updateUser(...a),["prevent"]))},[e("div",ye,[Ee,_(e("input",{type:"number",class:"form-control",id:"user-level","onUpdate:modelValue":s[3]||(s[3]=a=>l.updatedUser.level=a)},null,512),[[u,l.updatedUser.level]])]),e("div",Ue,[Ie,_(e("input",{disabled:"",type:"number",class:"form-control",id:"user-exp","onUpdate:modelValue":s[4]||(s[4]=a=>l.updatedUser.exp=a)},null,512),[[u,l.updatedUser.exp]])]),we],32)])])])],512),e("div",xe,[e("div",Ne,[e("div",Pe,[Te,e("div",Ae,[e("form",{onSubmit:s[10]||(s[10]=y((...a)=>n.addBadge&&n.addBadge(...a),["prevent"]))},[e("div",Ve,[ke,_(e("input",{type:"text",class:"form-control",id:"badge-name","onUpdate:modelValue":s[6]||(s[6]=a=>l.newBadge.name=a)},null,512),[[u,l.newBadge.name]])]),e("div",Me,[De,_(e("input",{type:"text",class:"form-control",id:"badge-description","onUpdate:modelValue":s[7]||(s[7]=a=>l.newBadge.description=a)},null,512),[[u,l.newBadge.description]])]),e("div",Ce,[Oe,_(e("input",{type:"text",class:"form-control",id:"badge-milestone","onUpdate:modelValue":s[8]||(s[8]=a=>l.newBadge.milestone=a)},null,512),[[u,l.newBadge.milestone]])]),e("div",Le,[Fe,e("input",{type:"file",class:"form-control",id:"badge-image",onChange:s[9]||(s[9]=(...a)=>n.handleFileUpload&&n.handleFileUpload(...a)),accept:".png, .jpg, .jpeg"},null,32)]),Se],32)])])])],512)])],64)}const Je=A(L,[["render",Ke],["__scopeId","data-v-7b0f9968"]]);export{Je as default};
