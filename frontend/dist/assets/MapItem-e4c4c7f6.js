import{_ as ie,l as re,r as F,o as T,c as j,a as e,t as _,d as A,b as L,k as de,w as I,s as ce,q as ue,v as B,h as H,F as pe,e as u,u as ge,x as ve,y as me,z as x,p as he,j as be,g as fe}from"./index-751a66e8.js";import{a as y}from"./Navbar-2917e1de.js";const _e=re({components:{},methods:{openGoogleMaps(){window.open(this.googleMapsUrl,"_blank")},openCityMapper(){window.open(this.citymapperUrl,"_blank")},getUserLocation(){console.log("getuserLocation called"),navigator.geolocation?(console.log("Browser supports nav-geolocation?: ",navigator.geolocation),navigator.geolocation.getCurrentPosition(t=>{console.log("Attempting to get current location");const a=t.coords.latitude,h=t.coords.longitude,P=`${a}, ${h}`;console.log("LocationString: ",P)})):this.errorMessage="Geolocation is not supported by this browser."}},computed:{googleMapsUrl(){const t=`${this.startLocation.lat},${this.startLocation.lng}`,a=`${this.destination.lat},${this.destination.lng}`;let h=this.travelMode.toLowerCase();return h==="drive"&&(h="driving"),h==="two_wheeler"&&(h="driving"),`https://www.google.com/maps/dir/?api=1&origin=${t}&destination=${a}&travelmode=${h}`},citymapperUrl(){const t=`${this.startLocation.lat},${this.startLocation.lng}`,a=`${this.destination.lat},${this.destination.lng}`;return`https://citymapper.com/directions?startcoord=${t}&endcoord=${a}`}},props:["userme"],setup(t){const a=u(0),h=u(0),P=u(0),R=u(0),V=u(0);y.get(`https://api.bchwy.com/users/ez/${t.userme.email}`).then(o=>{h.value=o.data.exp,P.value=100-h.value,R.value=o.data.level}).catch(o=>{console.error(o)});const M=u(""),{user:w,isAuthenticated:N}=ge(),b=u("DRIVE");u(null);const n=u(12),U=ve({lat:1.3331,lng:103.7428}),p=u({lat:0,lng:0}),g=u({lat:0,lng:0}),C=u({avoidTolls:!1,avoidHighways:!1,avoidFerries:!1}),k=u(null),K=u([]),G=u([]),W=me(()=>p.value.lat&&p.value.lng&&g.value.lat&&g.value.lng?[p.value,g.value]:[]),Z=o=>{const s=Number(o.geometry.location.lat()),l=Number(o.geometry.location.lng());if(p.value={lat:s,lng:l},U.lat=s,U.lng=l,g.value.lat&&g.value.lng){const c=X(p.value,g.value);n.value=z(c)}};function X(o,s){const c=o.lat*Math.PI/180,d=s.lat*Math.PI/180,v=(s.lat-o.lat)*Math.PI/180,m=(s.lng-o.lng)*Math.PI/180,i=Math.sin(v/2)*Math.sin(v/2)+Math.cos(c)*Math.cos(d)*Math.sin(m/2)*Math.sin(m/2);return 6371e3*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))}function z(o){return o>1e4?10:o>5e3||o>2e3||o>1e3||o>500?12:18}const q=o=>{const s=Number(o.geometry.location.lat()),l=Number(o.geometry.location.lng());if(g.value={lat:s,lng:l},p.value.lat&&p.value.lng){const c=X(p.value,g.value);n.value=z(c)}},E=u((()=>{const o=new Date;o.setMinutes(o.getMinutes()+5);const s=String(o.getHours()).padStart(2,"0"),l=String(o.getMinutes()).padStart(2,"0");return`${s}:${l}`})()),J=o=>{const[s,l]=E.value.split(":").map(Number),d=s*60+l+o,v=Math.floor(d/60)%24,m=d%60;E.value=`${String(v).padStart(2,"0")}:${String(m).padStart(2,"0")}`},Q=async()=>{var v,m;const[o,s]=E.value.split(":").map(Number),l=new Date;l.setHours(o),l.setMinutes(s);const c=l.toISOString();let d={origin:{location:{latLng:{latitude:p.value.lat,longitude:p.value.lng}}},destination:{location:{latLng:{latitude:g.value.lat,longitude:g.value.lng}}},travelMode:b.value,departureTime:c,computeAlternativeRoutes:!1,routeModifiers:{avoidTolls:C.value.avoidTolls,avoidHighways:C.value.avoidHighways,avoidFerries:C.value.avoidFerries},languageCode:"en-US",units:"IMPERIAL"};b.value==="DRIVE"&&(d.routingPreference="TRAFFIC_AWARE");try{const i=await y.post("https://routes.googleapis.com/directions/v2:computeRoutes",d,{headers:{"Content-Type":"application/json","X-Goog-Api-Key":"AIzaSyC6xTDY_NrDH0U1NSE2Ug6AnzuVsbRPFYM","X-Goog-FieldMask":"routes.duration,routes.distanceMeters,routes.polyline.encodedPolyline,routes.legs.steps"}});(m=(v=i.data.routes[0])==null?void 0:v.legs[0])!=null&&m.steps&&(G.value=i.data.routes[0].legs[0].steps),k.value=i.data.routes[0];const D=i.data.routes[0].polyline.encodedPolyline;K.value=ee(D),G.value=i.data.routes[0].legs[0].steps.map(f=>f);const S=async(f,le)=>{try{const $=await y.get(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${f},${le}&key=AIzaSyC6xTDY_NrDH0U1NSE2Ug6AnzuVsbRPFYM`);if($.data.results&&$.data.results.length>0)return $.data.results[0].formatted_address}catch($){console.error("Failed to fetch location name:",$)}return""},se=O(b.value,k.value.distanceMeters),ae=k.value.distanceMeters/1e3,ne={route_id:"route_"+Date.now(),start_point_lat_lng:`Point(${p.value.lat}, ${p.value.lng})`,end_point_lat_lng:`Point(${g.value.lat}, ${g.value.lng})`,start_point_name:await S(p.value.lat,p.value.lng),end_point_name:await S(g.value.lat,g.value.lng),transport_mode:b.value,carbon_emission:se,timestamp:new Date().toISOString(),user_id:t.userme.email};try{const f={"x-api-key":"PlanItIsTheBestProjectEverXYZ"};await y.post("https://api.bchwy.com/routes",ne,{headers:f}),await oe(te(),ae,b.value)}catch(f){console.error("Failed to store route data:",f),M.value=f.message+=" Please try again."}}catch(i){console.error("Failed to fetch route details:",i),M.value=i.message+=" Please try again."}},ee=o=>{let s=0,l=0,c=0;const d=[];let v=0;for(;s<o.length;){let m=0,i=0;do v=o.charCodeAt(s++)-63,i|=(v&31)<<m,m+=5;while(v>=32);const D=i&1?~(i>>1):i>>1;l+=D,m=0,i=0;do v=o.charCodeAt(s++)-63,i|=(v&31)<<m,m+=5;while(v>=32);const S=i&1?~(i>>1):i>>1;c+=S,d.push({lat:l/1e5,lng:c/1e5})}return d},O=()=>{const o=k.value.distanceMeters/1e3;let s;switch(b.value){case"driving":s=.12;break;case"bicycling":case"walking":s=0;break;default:s=.12}return o*s},te=()=>{const o=k.value.distanceMeters/1e3;let s;switch(console.log(b.value),b.value){case"driving":s=.12;break;case"BICYCLE":s=0;break;case"WALK":s=0;break;case"TRANSIT":s=0;break;default:s=.12}const l=o*.12;return[o*s,l]},oe=o=>{a.value=o[1]-o[0],console.log(o[0]),console.log(o[1]),console.log(a.value);const s=10,l=10,c=s+a.value*l;V.value=c,y.post(`https://api.bchwy.com/users/${w.value.email}/carbonsavings`,{carbonsavings:a.value},{headers:{"X-Api-Key":"PlanItIsTheBestProjectEverXYZ"}}).then(d=>{console.log(d.data.message),Y(`saved :${a.value} co2`)}).catch(d=>{console.error(d)}),y.post(`https://api.bchwy.com/users/${w.value.email}/exp`,{exp:c},{headers:{"X-Api-Key":"PlanItIsTheBestProjectEverXYZ"}}).then(d=>{console.log(d.data.message),Y(`gained ${c} exp`)}).catch(d=>{console.error(d)})},Y=o=>{y.post(`https://api.bchwy.com/users/${w.value.email}/log`,{activity:o},{headers:{"X-Api-Key":"PlanItIsTheBestProjectEverXYZ"}}).then(s=>{console.log(s.data.message)}).catch(s=>{console.error(s)})};return{calculateCarbonEmission:O,addMinutes:J,departureTime:E,routeModifiers:C,center:U,startLocation:p,destination:g,setStartLocation:Z,setDestination:q,fetchRouteDetails:Q,routeDetails:k,polylinePath:W,decodedPolyline:K,travelMode:b,directionSteps:G,user:w,isAuthenticated:N,zoom:n,errorMessage:M,emissionSavings:a,userExp:h,expToNextLevel:P,userLvl:R,expAdded:V}}}),r=t=>(he("data-v-33f184a0"),t=t(),be(),t),ye={class:"row"},Me={key:0,class:"alert alert-danger",role:"alert"},we={class:"col-lg-8 col-md-12 p-0"},ke={class:"col-lg-4 col-md-12 p-4"},Pe={class:"mb-4"},Se={class:"input-group mb-3"},$e=r(()=>e("span",{class:"input-group-text font-weight-bold",id:"autocomplete-label"},"Start Location",-1)),Te={class:"input-group mb-3"},Ie=r(()=>e("span",{class:"input-group-text font-weight-bold",id:"autocomplete-label"},"End Location",-1)),Ce={class:"input-group mb-3"},Ee=r(()=>e("span",{class:"input-group-text font-weight-bold"},"Travel Mode",-1)),De=fe('<option value="DRIVE" data-v-33f184a0>Drive</option><option value="TWO_WHEELER" data-v-33f184a0>Motorbike</option><option value="TRANSIT" data-v-33f184a0>Public Transport</option><option value="BICYCLE" data-v-33f184a0>Bicycle</option><option value="WALK" data-v-33f184a0>Walk</option>',5),Fe=[De],Ae={class:"input-group mb-3"},Le=r(()=>e("span",{class:"input-group-text font-weight-bold"},"Departure Time",-1)),Re={class:"mb-4"},Ve=r(()=>e("span",{class:"d-block mb-2 font-weight-bold"},"Route Modifiers",-1)),Ne={class:"form-check"},Ue=r(()=>e("label",{class:"form-check-label",for:"avoidTolls"},"Avoid Tolls",-1)),Ge={class:"form-check"},je=r(()=>e("label",{class:"form-check-label",for:"avoidHighways"},"Avoid Highways",-1)),Be={class:"form-check"},He=r(()=>e("label",{class:"form-check-label",for:"avoidFerries"},"Avoid Ferries",-1)),Ke={class:"mb-4"},Xe={class:"modal fade",id:"progressModal",tabindex:"-1","aria-labelledby":"progressModalLabel","aria-hidden":"true"},ze={class:"modal-dialog"},Oe={key:0,class:"modal-content"},Ye=r(()=>e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"progressModalLabel"},"Progress"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),xe={class:"modal-body"},We=r(()=>e("h5",{class:"card-title mb-4"},"Route Details",-1)),Ze={class:"d-flex justify-content-between mb-2"},qe=r(()=>e("strong",null,"Distance:",-1)),Je={class:"d-flex justify-content-between mb-2"},Qe=r(()=>e("span",null,[e("strong",null,"Duration:")],-1)),et={class:"d-flex justify-content-between mb-3"},tt=r(()=>e("span",null,[e("strong",null,"Carbon Emission:")],-1)),ot=r(()=>e("hr",null,null,-1)),st={class:"d-flex justify-content-between mb-3"},at=r(()=>e("span",null,[e("strong",null,"User Level:")],-1)),nt=r(()=>e("div",{class:"d-flex justify-content-between mb-3"},null,-1)),lt={class:"d-flex justify-content-between mb-3"},it=r(()=>e("span",null,[e("strong",null,"Experience Added:")],-1)),rt={class:"d-flex justify-content-between mb-3"},dt=r(()=>e("span",null,[e("strong",null,"Emission Savings:")],-1)),ct={class:"d-flex justify-content-center"},ut=r(()=>e("i",{class:"fas fa-map-marker-alt"},null,-1)),pt=r(()=>e("i",{class:"fas fa-map-marker-alt"},null,-1)),gt=r(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1));function vt(t,a,h,P,R,V){const M=F("GMapMarker"),w=F("GMapPolyline"),N=F("GMapMap"),b=F("GMapAutocomplete");return T(),j(pe,null,[e("div",ye,[t.errorMessage?(T(),j("div",Me,_(t.errorMessage),1)):A("",!0),e("div",we,[L(N,{class:"w-100 vh-100",center:t.center,zoom:t.zoom,"map-type-id":"terrain"},{default:de(()=>[t.startLocation.lat&&t.startLocation.lng?(T(),x(M,{key:0,position:t.startLocation},null,8,["position"])):A("",!0),t.destination.lat&&t.destination.lng?(T(),x(M,{key:1,position:t.destination},null,8,["position"])):A("",!0),L(w,{path:t.decodedPolyline,editable:!1,ref:"polyline",options:{strokeColor:"#00FF00"}},null,8,["path"])]),_:1},8,["center","zoom"])]),e("div",ke,[e("div",Pe,[e("div",Se,[$e,L(b,{ref:"autocomplete",modelValue:t.startLocation.value,"onUpdate:modelValue":a[0]||(a[0]=n=>t.startLocation.value=n),placeholder:"Starting point",componentRestrictions:{country:"SG"},onPlace_changed:t.setStartLocation,class:"form-control"},null,8,["modelValue","onPlace_changed"])]),e("div",Te,[Ie,L(b,{modelValue:t.destination.value,"onUpdate:modelValue":a[1]||(a[1]=n=>t.destination.value=n),placeholder:"Destination",componentRestrictions:{country:"SG"},onPlace_changed:t.setDestination,class:"form-control"},null,8,["modelValue","onPlace_changed"])]),e("div",Ce,[Ee,I(e("select",{"onUpdate:modelValue":a[2]||(a[2]=n=>t.travelMode=n),class:"form-control"},Fe,512),[[ce,t.travelMode]])]),e("div",Ae,[Le,I(e("input",{type:"time","onUpdate:modelValue":a[3]||(a[3]=n=>t.departureTime=n),class:"form-control"},null,512),[[ue,t.departureTime]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:a[4]||(a[4]=n=>t.addMinutes(5))},"+5m")])]),e("div",Re,[Ve,e("div",Ne,[I(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"avoidTolls","onUpdate:modelValue":a[5]||(a[5]=n=>t.routeModifiers.avoidTolls=n)},null,512),[[B,t.routeModifiers.avoidTolls]]),Ue]),e("div",Ge,[I(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"avoidHighways","onUpdate:modelValue":a[6]||(a[6]=n=>t.routeModifiers.avoidHighways=n)},null,512),[[B,t.routeModifiers.avoidHighways]]),je]),e("div",Be,[I(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"avoidFerries","onUpdate:modelValue":a[7]||(a[7]=n=>t.routeModifiers.avoidFerries=n)},null,512),[[B,t.routeModifiers.avoidFerries]]),He])]),e("div",Ke,[e("button",{class:"btn btn-primary w-100",onClick:a[8]||(a[8]=(...n)=>t.fetchRouteDetails&&t.fetchRouteDetails(...n)),"data-bs-toggle":"modal","data-bs-target":"#progressModal"},"Log Route")])])]),e("div",Xe,[e("div",ze,[t.routeDetails?(T(),j("div",Oe,[Ye,e("div",xe,[We,e("div",Ze,[qe,H(" "+_(t.routeDetails.distanceMeters.toFixed(0))+"m / "+_((t.routeDetails.distanceMeters/1e3).toFixed(2))+"km ",1)]),e("div",Je,[Qe,e("span",null,_(t.routeDetails.duration)+" seconds",1)]),e("div",et,[tt,e("span",null,_(t.calculateCarbonEmission().toFixed(2))+" kg CO2",1)]),ot,e("div",st,[at,e("span",null,_(t.userLvl),1)]),nt,e("div",lt,[it,e("span",null,"+"+_(t.expAdded),1)]),e("div",rt,[dt,e("span",null,_(t.emissionSavings.toFixed(2))+" kg CO2",1)]),e("div",ct,[e("button",{class:"btn btn-primary rounded-pill shadow-sm",onClick:a[9]||(a[9]=(...n)=>t.openGoogleMaps&&t.openGoogleMaps(...n))},[ut,H(" Open on Google Maps ")]),e("button",{class:"btn btn-green rounded-pill shadow-sm",onClick:a[10]||(a[10]=(...n)=>t.openCityMapper&&t.openCityMapper(...n))},[pt,H(" Open on CityMapper ")])])]),gt])):A("",!0)])])],64)}const ft=ie(_e,[["render",vt],["__scopeId","data-v-33f184a0"]]);export{ft as M};
