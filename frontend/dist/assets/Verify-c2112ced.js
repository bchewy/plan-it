import{M as G,u as w,a as T}from"./MapItem-bd834173.js";import{A as k,F as V,B as C}from"./Badges-8adfbbcb.js";import{N as D}from"./Navbar-faf4802b.js";import{_ as L,u as B,e as b,r as x,o as v,c as g,l as R,b as f,K as S,a as e,F as N,f as K,d as F,t as d,n as X,i as u,w as Y,p as O,h as U}from"./index-0fdca0a9.js";import{a as p}from"./axios-21b846bc.js";import"./index-f203fe86.js";/* empty css              */const $={components:{Navbar:D,MapItem:G,AddFriend:k,FriendRequest:V,Badges:C},watch:{userLvl:{handler(){this.fetchUser()},immediate:!0}},created(){this.fetchData()},data(){const{user:s,isAuthenticated:n}=B(),a=b(0),o=b(0),{coords:t,locatedAt:c,error:_,resume:l,pause:h}=w(),i=b(0),m=b(0),E=b(null);return{userExp:a,userLvl:o,user:s,isAuthenticated:n,routes:[],coords:t,emissionSavings:i,expToAddG:m,dancingGif:E}},methods:{fetchData(){this.fetchRoutes(),this.fetchRandomGif(),this.fetchUser()},haversineDistance(s,n,a=!1){function o(M){return M*Math.PI/180}var t=s[1],c=s[0],_=n[1],l=n[0],h=6371,i=l-c,m=o(i),E=_-t,y=o(E),I=Math.sin(m/2)*Math.sin(m/2)+Math.cos(o(c))*Math.cos(o(l))*Math.sin(y/2)*Math.sin(y/2),P=2*Math.atan2(Math.sqrt(I),Math.sqrt(1-I)),A=h*P;return a&&(A/=1.60934),A},async fetchRandomGif(){const s=`https://api.giphy.com/v1/gifs/random?api_key=${{}.VITE_GIFY_API_KEY}&tag=dancing&rating=g`;try{const n=await p.get(s);this.dancingGif=n.data.data.images.fixed_height.url,console.log(this.dancingGif)}catch(n){console.error("Error fetching random gif:",n)}},async fetchUser(){const s=`${{}.VITE_API_ENDPOINT}/users/iz/${encodeURIComponent(this.user.email)}`,n={"x-api-key":`${{}.VITE_API_KEY}`};try{const a=await p.get(s,{headers:n});this.userLvl=a.data.level,this.userExp=a.data.exp}catch(a){console.error("Error fetching user",a)}},async fetchRoutes(){const s=this.user.email,n=`${{}.VITE_API_ENDPOINT}/routes/email?email=${encodeURIComponent(s)}`,a={"x-api-key":`${{}.VITE_API_KEY}`};try{const t=(await p.get(n,{headers:a})).data.filter(c=>!c.validated);this.routes=t.reverse()}catch(o){console.error("Error fetching routes:",o)}},async updateRoute(s){const n=`${{}.VITE_API_ENDPOINT}/routes/${s}/validate`,a={"x-api-key":`${{}.VITE_API_KEY}`};try{return(await p.put(n,{},{headers:a})).data}catch(o){console.error("Error updating route:",o)}},calculateCarbonEmissionForEXP(s,n){const a=s;let o;switch(n){case"driving":o=.12;break;case"BICYCLE":o=0;break;case"WALK":o=0;break;case"TRANSIT":o=0;break;default:o=.12}const t=a*.12;return[a*o,t]},addExpBasedOnCarbonEmission(s){this.emissionSavings=s[1]-s[0];const n=10,a=10,o=Math.ceil(n+this.emissionSavings*a);this.expToAddG+=o,p.post(`${{}.VITE_API_ENDPOINT}/users/${this.user.email}/carbonsavings`,{carbonsavings:this.emissionSavings},{headers:{"X-Api-Key":`${{}.VITE_API_KEY}`}}).then(t=>{console.log(t.data.message)}).catch(t=>{console.error(t)}),p.post(`${{}.VITE_API_ENDPOINT}/users/${this.user.email}/exp`,{exp:this.expToAddG},{headers:{"X-Api-Key":`${{}.VITE_API_KEY}`}}).then(t=>{console.log(t.data.message)}).catch(t=>{console.error(t)})},checkEndLocation(s){const{latitude:n,longitude:a}=this.coords,[o,t]=s.end_point_lat_lng.split(", ").map(Number);if(this.haversineDistance([n,a],[o,t])<.5){console.log("User is within 500 meters of the end location"),this.updateRoute(s.route_id,!0),this.routes=this.routes.filter(h=>h.route_id!==s.route_id),this.addExpBasedOnCarbonEmission(this.calculateCarbonEmissionForEXP(s.distance,s.transport_mode)),console.log("Added EXP:",this.expToAddG);var _=document.getElementById("modalGood"),l=new T(_);l.show()}else{console.log("User is not within 500 meters of the end location");var _=document.getElementById("modalBad"),l=new T(_);l.show()}_.addEventListener("hidden.bs.modal",function(){document.body.classList.remove("modal-open"),document.body.style.removeProperty("padding-right");let h=document.querySelector(".navbar.fixed-top");h&&h.style.removeProperty("padding-right")})}}},r=s=>(O("data-v-2236677b"),s=s(),U(),s),q={class:"container-fluid pt-3 bg-supergreen pb-3"},z={class:"row"},W={class:"col-lg-12"},j={class:"card"},H=r(()=>e("div",{class:"card-header"},[e("h4",{class:"card-title text-center"},"Invalid Routes"),e("p",{class:"card-text text-center"},[u("The invalid routes here do not have their end locations verified. "),e("strong",null,"Verify your end locations"),u(" before the time limit to get more EXP.")])],-1)),J={class:"card-body"},Q={class:"table-responsive"},Z={class:"table table-striped"},ee=r(()=>e("thead",null,[e("tr",null,[e("th",null,"Map"),e("th",null,"Details")])],-1)),te={key:0},se={class:"col-9"},oe=r(()=>e("br",null,null,-1)),ne=r(()=>e("br",null,null,-1)),ae=r(()=>e("br",null,null,-1)),ie=r(()=>e("br",null,null,-1)),re=r(()=>e("br",null,null,-1)),le=r(()=>e("br",null,null,-1)),de=["onClick"],ce=r(()=>e("br",null,null,-1)),_e={class:"modal fade",id:"modalGood",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},he={class:"modal-dialog"},ue={class:"modal-content"},pe={class:"modal-body"},me={class:"text-center"},be=["src"],ve=r(()=>e("br",null,null,-1)),ge=r(()=>e("h2",null,"Congratulations!",-1)),fe={class:"table table-hover"},Ee=r(()=>e("td",null,"Your current EXP:",-1)),xe=r(()=>e("td",null,"Your new EXP:",-1)),ye={class:"progress"},Ie=r(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-success","data-bs-dismiss":"modal"},"Close")],-1)),Ae={class:"modal fade",id:"modalBad",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Te={class:"modal-dialog"},Ne={class:"modal-content"},Pe={class:"modal-body text-center"},Me=["src"],Ge=r(()=>e("br",null,null,-1)),we=r(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-danger","data-bs-dismiss":"modal"},"Close")],-1));function ke(s,n,a,o,t,c){const _=x("Navbar"),l=x("GMapMarker"),h=x("GMapMap");return v(),g(N,null,[(v(),R(S,null,[f(_)],1024)),e("div",q,[e("div",z,[e("div",W,[e("div",j,[H,e("div",J,[e("div",Q,[e("table",Z,[ee,t.routes?(v(),g("tbody",te,[(v(!0),g(N,null,K(t.routes,i=>(v(),g("tr",{key:i.id},[e("td",se,[f(h,{center:{lat:Number(i.start_point_lat_lng.split(",")[0]),lng:Number(i.start_point_lat_lng.split(",")[1])},zoom:10,"map-type-id":"terrain",style:{width:"100%",height:"200px"}},{default:Y(()=>[f(l,{position:{lat:Number(i.start_point_lat_lng.split(",")[0]),lng:Number(i.start_point_lat_lng.split(",")[1])}},null,8,["position"]),f(l,{position:{lat:Number(i.end_point_lat_lng.split(",")[0]),lng:Number(i.end_point_lat_lng.split(",")[1])}},null,8,["position"])]),_:2},1032,["center"])]),e("td",null,[u(" Start: "),e("b",null,d(i.start_point_name),1),oe,u(" End: "),e("b",null,d(i.end_point_name),1),ne,u(" Distance: "),e("b",null,d(i.distance)+" km",1),ae,u(" Carbon Emission: "),e("b",null,d(i.carbon_emission.toFixed(2))+"g",1),ie,u(" Transport Mode: "),e("b",null,d(i.transport_mode),1),re,u(" Time: "),e("b",null,d(new Date(i.timestamp).toLocaleString()),1),le,e("button",{class:"btn btn-success mt-2",onClick:m=>c.checkEndLocation(i)},"Validate Route",8,de),ce])]))),128))])):F("",!0)])])])])])]),e("div",_e,[e("div",he,[e("div",ue,[e("div",pe,[e("div",me,[e("img",{src:t.dancingGif,alt:"Dancing Gif"},null,8,be),ve,ge]),e("table",fe,[e("tr",null,[Ee,e("td",null,d(t.userExp)+"/100",1)]),e("tr",null,[xe,e("td",null,d(t.userExp+t.expToAddG)+"/100 (+ "+d(t.expToAddG)+")",1)])]),e("div",ye,[e("div",{class:"progress-bar bg-supergreen",role:"progressbar",style:X({width:t.userExp+t.expToAddG+"%"}),"aria-valuenow":"userExp","aria-valuemin":"0","aria-valuemax":"userLvl * 100"},d((t.userExp+t.expToAddG).toFixed(2))+"%",5)])]),Ie])])]),e("div",Ae,[e("div",Te,[e("div",Ne,[e("div",Pe,[e("img",{src:t.dancingGif,alt:"Dancing Gif"},null,8,Me),Ge,u(" It appears there may be some inaccuracies in your routes... ")]),we])])])])],64)}const Ke=L($,[["render",ke],["__scopeId","data-v-2236677b"]]);export{Ke as default};
