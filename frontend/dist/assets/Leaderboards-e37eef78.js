import{M as v}from"./MapItem-bd834173.js";import{A as E,F as y,B as N}from"./Badges-8adfbbcb.js";import{N as T}from"./Navbar-faf4802b.js";import{_ as $,u as P,e as p,r as w,o as n,c as d,b as x,a as e,F as m,f as b,t as h,i as I,d as A,p as V,h as k}from"./index-0fdca0a9.js";import{a as _}from"./axios-21b846bc.js";import"./index-f203fe86.js";/* empty css              */const D={created(){this.fetchData()},watch:{activeTab:{immediate:!0,handler(r,a){r==="routes"&&this.$nextTick(()=>{this.fetchData()})}}},data(){const{user:r,isAuthenticated:a}=P(),s=p(0),o=p(0),c=p(0),u=[],l=p([]),t=p([]);return{users:u,userExp:s,expToNextLevel:o,userLvl:c,user:r,isAuthenticated:a,routes:[],friends:l,friendRequests:[],receivedRequests:[],sentRequests:[],badges:[],friendStats:t}},components:{Navbar:T,MapItem:v,AddFriend:E,FriendRequest:y,Badges:N},methods:{async fetchData(){this.fetchUsers(),await this.fetchUser(),this.fetchFriendStats(this.friends)},async fetchUser(){const r=`${{}.VITE_API_ENDPOINT}/users/iz/${encodeURIComponent(this.user.email)}`,a={"x-api-key":`${{}.VITE_API_KEY}`};try{const s=await _.get(r,{headers:a});this.friends=s.data.friends,this.userLvl=s.data.level,this.userExp=s.data.exp}catch(s){console.error("Error fetching user",s)}},async fetchBadges(){const r=`${{}.VITE_API_ENDPOINT}/users/${encodeURIComponent(this.user.email)}/badges`,a={"x-api-key":`${{}.VITE_API_KEY}`};try{const s=await _.get(r,{headers:a});this.badges=s.data.badges}catch(s){console.error("Error fetching badges",s)}},async fetchRoutes(){const r=this.user.email,a=`${{}.VITE_API_ENDPOINT}/routes/email?email=${encodeURIComponent(r)}`,s={"x-api-key":`${{}.VITE_API_KEY}`};try{const o=await _.get(a,{headers:s});this.routes=o.data.reverse()}catch(o){console.error("Error fetching routes:",o)}},async fetchUsers(){const r=`${{}.VITE_API_ENDPOINT}/users`,a={"x-api-key":`${{}.VITE_API_KEY}`};try{const s=await _.get(r,{headers:a});this.users=s.data;for(let o of this.users)try{const c=`${{}.VITE_API_ENDPOINT}/users/${o.email}/badges`,l=(await _.get(c,{headers:a})).data;o.badges=[];for(let t of l)try{const i=`${{}.VITE_API_ENDPOINT}/badges/${t}`,g=await _.get(i,{headers:a});o.badges.push({id:t,image:g.data.image})}catch(i){console.error(`Error fetching details for badge with ID ${t}:`,i)}}catch(c){console.error(`Error fetching badges for user with email ${o.email}:`,c)}}catch(s){console.error("Error fetching users:",s)}},async fetchFriendStats(r){try{const a=[];for(let s of r){const o=`${{}.VITE_API_ENDPOINT}/users/iz/${encodeURIComponent(s)}`,c={"x-api-key":`${{}.VITE_API_KEY}`},u=await _.get(o,{headers:c});if(a.push({...s,stats:{...u.data,badges:[]}}),Array.isArray(u.data.badges))for(let l of u.data.badges){const t=`${{}.VITE_API_ENDPOINT}/badges/${l}`,i=await _.get(t,{headers:c});a[a.length-1].stats.badges.push({id:l,badgesimg:i.data.image})}}this.friendStats=a,this.friendStats.sort((s,o)=>s.stats.level-o.stats.level).reverse()}catch(a){console.error("Error fetching friend stats:",a)}}}},f=r=>(V("data-v-255ed5ed"),r=r(),k(),r),R={class:"container-fluid pt-3 bg-supergreen pb-3"},U={class:"row"},S={class:"col-lg-12"},B={class:"card"},O=f(()=>e("div",{class:"card-header"},[e("h4",{class:"card-title"},"Global Leaderboard")],-1)),C={class:"card-body"},L={class:"table-responsive"},F={class:"table"},K=f(()=>e("thead",null,[e("tr",null,[e("th",null,"Rank"),e("th",null,"Name"),e("th",null,"Badges Earned"),e("th",null,"Level"),e("th",null,"CO2 Saved")])],-1)),Y=["src"],q=["src"],z={key:0},M={key:1},G={class:"col-lg-12 mt-5"},j={class:"card"},H=f(()=>e("div",{class:"card-header"},[e("h4",{class:"card-title"},"Friends Leaderboard")],-1)),J={class:"card-body"},Q={class:"table-responsive"},W={class:"table"},X=f(()=>e("thead",null,[e("tr",null,[e("th",null,"Rank"),e("th",null,"Name"),e("th",null,"Badges Earned"),e("th",null,"Level"),e("th",null,"CO2 Saved")])],-1)),Z=["src"],ee=["src"],se={key:0};function te(r,a,s,o,c,u){const l=w("Navbar");return n(),d(m,null,[x(l),e("div",R,[e("div",U,[e("div",S,[e("div",B,[O,e("div",C,[e("div",L,[e("table",F,[K,e("tbody",null,[(n(!0),d(m,null,b(c.users,(t,i)=>(n(),d("tr",{key:t.email},[e("td",null,h(i+1),1),e("td",null,[e("img",{src:t.pictureurl,alt:"User Image",width:"50",height:"50"},null,8,Y),I("  "),e("span",null,"@"+h(t.handle),1)]),e("td",null,[(n(!0),d(m,null,b(t.badges,g=>(n(),d("span",{key:g.id},[e("img",{src:g.image,alt:"Badge Image",width:"50",height:"50"},null,8,q)]))),128))]),e("td",null,h(t.level),1),t.carbonsavings?(n(),d("td",z,h(t.carbonsavings.toFixed(2))+"g Co2 ",1)):(n(),d("td",M))]))),128))])])])])])]),e("div",G,[e("div",j,[H,e("div",J,[e("div",Q,[e("table",W,[X,e("tbody",null,[(n(!0),d(m,null,b(c.friendStats,(t,i)=>(n(),d("tr",{key:t.email},[e("td",null,h(i+1),1),e("td",null,[e("img",{src:t.stats.pictureurl,alt:"User Image",width:"50",height:"50"},null,8,Z),I("  "),e("span",null,"@"+h(t.stats.handle),1)]),e("td",null,[(n(!0),d(m,null,b(t.stats.badges,g=>(n(),d("span",{key:g.id},[e("img",{src:g.badgesimg,alt:"Badge Image",width:"50",height:"50"},null,8,ee)]))),128))]),e("td",null,h(t.stats.level),1),t.stats.carbonsavings?(n(),d("td",se,h(t.stats.carbonsavings)+"g CO2",1)):A("",!0)]))),128))])])])])])])])])],64)}const le=$(D,[["render",te],["__scopeId","data-v-255ed5ed"]]);export{le as default};
